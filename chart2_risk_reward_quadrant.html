<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Risk-Reward Quadrant | Fenwick Tutoring</title>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: white;
            color: #000;
            line-height: 1.6;
        }
        
        .container {
            width: 100%;
            max-width: none;
            margin: 0;
            background-color: white;
            padding: 30px 5%;
        }
        
        h1 {
            color: #5d2137;
            font-size: clamp(22px, 4vw, 32px);
            margin-bottom: 8px;
            font-weight: bold;
        }
        
        .subtitle {
            color: #ba684e;
            font-size: clamp(14px, 2vw, 18px);
            margin-bottom: 25px;
        }
        
        #chart {
            width: 100%;
            height: 700px;
            margin: 30px 0;
        }
        
        .footer {
            text-align: center;
            color: #ba684e;
            font-size: 13px;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #fee9e2;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 20px 4%;
            }
            
            #chart {
                height: 500px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Risk-Reward Quadrant: Where Does Your Subject Sit?</h1>
        <p class="subtitle">Only 6.9% of IB subjects offer both low risk and high reward</p>
        
        <div id="chart"></div>
        
        <div class="footer">
            <p><strong>Fenwick Tutoring</strong> | Data: IB May 2025 Statistical Bulletin</p>
        </div>
    </div>

    <script>
        // Detect mobile vs desktop
        const isMobile = window.innerWidth < 768;
        
        // Load and process the data using relative path
        fetch('./ib_risk_reward_analysis.csv')
            .then(response => response.text())
            .then(csvData => {
                const rows = csvData.trim().split('\n');
                
                // Parse CSV data handling quoted fields
                function parseCSVRow(row) {
                    const result = [];
                    let current = '';
                    let inQuotes = false;
                    
                    for (let i = 0; i < row.length; i++) {
                        const char = row[i];
                        if (char === '"') {
                            inQuotes = !inQuotes;
                        } else if (char === ',' && !inQuotes) {
                            result.push(current.trim());
                            current = '';
                        } else {
                            current += char;
                        }
                    }
                    result.push(current.trim());
                    return result;
                }
                
                const data = rows.slice(1).map(row => {
                    const values = parseCSVRow(row);
                    return {
                        subject: values[0],
                        level: values[1],
                        group: values[2],
                        students: parseInt(values[3]),
                        meanGrade: parseFloat(values[4]),
                        stdDev: parseFloat(values[5]),
                        pctGrade7: parseFloat(values[6]),
                        pctGrade67: parseFloat(values[7]),
                        pctGrade13: parseFloat(values[8]),
                        riskScore: parseFloat(values[9]),
                        rewardScore: parseFloat(values[10]),
                        category: values[11]
                    };
                });
                
                // Define colors for categories using brand colors
                const categoryColors = {
                    'LOW RISK, HIGH REWARD': '#5d2137',
                    'HIGH RISK, HIGH REWARD': '#ba684e',
                    'LOW RISK, LOW REWARD': '#999999',
                    'HIGH RISK, LOW REWARD': '#000000'
                };
                
                const categoryOrder = [
                    'LOW RISK, HIGH REWARD',
                    'HIGH RISK, HIGH REWARD',
                    'LOW RISK, LOW REWARD',
                    'HIGH RISK, LOW REWARD'
                ];
                
                // Create traces for each category
                const traces = categoryOrder.map(category => {
                    const categoryData = data.filter(d => d.category === category);
                    
                    return {
                        x: categoryData.map(d => d.riskScore),
                        y: categoryData.map(d => d.rewardScore),
                        mode: 'markers',
                        type: 'scatter',
                        name: category,
                        marker: {
                            size: isMobile ? 8 : 10,
                            color: categoryColors[category],
                            opacity: 0.7,
                            line: {
                                color: 'white',
                                width: 1.5
                            }
                        },
                        text: categoryData.map(d => 
                            isMobile
                            ? `<b>${d.subject} ${d.level}</b><br>Risk: ${d.riskScore.toFixed(1)}<br>Reward: ${d.rewardScore.toFixed(1)}`
                            : `<b>${d.subject} ${d.level}</b><br>` +
                              `Risk Score: ${d.riskScore.toFixed(1)}<br>` +
                              `Reward Score: ${d.rewardScore.toFixed(1)}<br>` +
                              `Grade 7: ${d.pctGrade7.toFixed(1)}%<br>` +
                              `Grade 6-7: ${d.pctGrade67.toFixed(1)}%<br>` +
                              `Grade 1-3: ${d.pctGrade13.toFixed(1)}%<br>` +
                              `Mean Grade: ${d.meanGrade.toFixed(1)}<br>` +
                              `Students: ${d.students.toLocaleString()}`
                        ),
                        hovertemplate: '%{text}<extra></extra>',
                        hoverlabel: {
                            font: {
                                size: isMobile ? 11 : 13
                            }
                        }
                    };
                });
                
                // Add labels for notable subjects - hide on mobile
                const labelSubjects = isMobile ? [] : [
                    'Physics HL',
                    'Math Applications SL',
                ];
                
                const annotations = data
                    .filter(d => labelSubjects.some(ls => `${d.subject} ${d.level}` === ls))
                    .map(d => ({
                        x: d.riskScore,
                        y: d.rewardScore,
                        text: `${d.subject} ${d.level}`,
                        showarrow: false,
                        font: {
                            size: 10,
                            color: '#5d2137'
                        },
                        bgcolor: 'rgba(255, 255, 255, 0.8)',
                        bordercolor: '#5d2137',
                        borderwidth: 1,
                        borderpad: 3,
                        xshift: 0,
                        yshift: 12
                    }));
                
                // Add quadrant labels - adjusted for mobile
                const quadrantAnnotations = isMobile ? [
                    {
                        x: 20,
                        y: 75,
                        text: '<b>LOW RISK<br>HIGH REWARD</b>',
                        showarrow: false,
                        font: { size: 10, color: '#5d2137' },
                        bgcolor: 'rgba(254, 233, 226, 0.8)',
                        bordercolor: '#5d2137',
                        borderwidth: 1,
                        borderpad: 4
                    },
                    {
                        x: 70,
                        y: 75,
                        text: '<b>HIGH RISK<br>HIGH REWARD</b>',
                        showarrow: false,
                        font: { size: 10, color: '#ba684e' },
                        bgcolor: 'rgba(254, 233, 226, 0.8)',
                        bordercolor: '#ba684e',
                        borderwidth: 1,
                        borderpad: 4
                    },
                    {
                        x: 70,
                        y: 25,
                        text: '<b>DANGER ZONE</b>',
                        showarrow: false,
                        font: { size: 10, color: '#000' },
                        bgcolor: 'rgba(254, 233, 226, 0.8)',
                        bordercolor: '#000',
                        borderwidth: 1,
                        borderpad: 4
                    }
                ] : [
                    {
                        x: 20,
                        y: 75,
                        text: '<b>LOW RISK<br>HIGH REWARD</b><br>(4 subjects, 6.9%)',
                        showarrow: false,
                        font: { size: 12, color: '#5d2137' },
                        bgcolor: 'rgba(254, 233, 226, 0.8)',
                        bordercolor: '#5d2137',
                        borderwidth: 2,
                        borderpad: 8
                    },
                    {
                        x: 70,
                        y: 75,
                        text: '<b>HIGH RISK<br>HIGH REWARD</b><br>(8 subjects, 13.8%)',
                        showarrow: false,
                        font: { size: 12, color: '#ba684e' },
                        bgcolor: 'rgba(254, 233, 226, 0.8)',
                        bordercolor: '#ba684e',
                        borderwidth: 2,
                        borderpad: 8
                    },
                    {
                        x: 20,
                        y: 25,
                        text: '<b>LOW RISK<br>LOW REWARD</b><br>(7 subjects, 12.1%)',
                        showarrow: false,
                        font: { size: 12, color: '#999' },
                        bgcolor: 'rgba(254, 233, 226, 0.8)',
                        bordercolor: '#999',
                        borderwidth: 2,
                        borderpad: 8
                    },
                    {
                        x: 70,
                        y: 25,
                        text: '<b>DANGER ZONE</b><br>(39 subjects, 67.2%)',
                        showarrow: false,
                        font: { size: 12, color: '#000' },
                        bgcolor: 'rgba(254, 233, 226, 0.8)',
                        bordercolor: '#000',
                        borderwidth: 2,
                        borderpad: 8
                    }
                ];
                
                const layout = {
                    xaxis: {
                        title: {
                            text: 'Risk Score (0-100) →',
                            font: {
                                size: isMobile ? 11 : 14,
                                color: '#5d2137',
                                family: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto'
                            }
                        },
                        gridcolor: '#fee9e2',
                        range: [0, 100],
                        zeroline: false
                    },
                    yaxis: {
                        title: {
                            text: 'Reward Score (0-100) →',
                            font: {
                                size: isMobile ? 11 : 14,
                                color: '#5d2137',
                                family: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto'
                            }
                        },
                        gridcolor: '#fee9e2',
                        range: [0, 100],
                        zeroline: false
                    },
                    hovermode: 'closest',
                    showlegend: !isMobile,
                    legend: {
                        x: 0.02,
                        y: 0.98,
                        bgcolor: 'rgba(255, 255, 255, 0.9)',
                        bordercolor: '#5d2137',
                        borderwidth: 1,
                        font: { size: 10 }
                    },
                    plot_bgcolor: 'white',
                    paper_bgcolor: 'white',
                    font: {
                        family: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto',
                        color: '#000'
                    },
                    margin: isMobile 
                        ? { l: 45, r: 10, t: 20, b: 50 }
                        : { l: 80, r: 30, t: 30, b: 70 },
                    shapes: [
                        // Vertical line at x=40 (risk threshold)
                        {
                            type: 'line',
                            x0: 40,
                            y0: 0,
                            x1: 40,
                            y1: 100,
                            line: {
                                color: '#5d2137',
                                width: 2,
                                dash: 'dot'
                            }
                        },
                        // Horizontal line at y=50 (reward threshold)
                        {
                            type: 'line',
                            x0: 0,
                            y0: 50,
                            x1: 100,
                            y1: 50,
                            line: {
                                color: '#5d2137',
                                width: 2,
                                dash: 'dot'
                            }
                        }
                    ],
                    annotations: [...quadrantAnnotations, ...annotations]
                };
                
                const config = {
                    responsive: true,
                    displayModeBar: !isMobile,
                    displaylogo: false,
                    modeBarButtonsToRemove: ['pan2d', 'lasso2d', 'select2d'],
                    toImageButtonOptions: {
                        format: 'png',
                        filename: 'risk_reward_quadrant_fenwick_tutoring',
                        height: 900,
                        width: 1400,
                        scale: 2
                    }
                };
                
                Plotly.newPlot('chart', traces, layout, config);
                
                // Force resize after load and on window resize
                window.addEventListener('resize', function() {
                    Plotly.Plots.resize('chart');
                });
            })
            .catch(error => {
                console.error('Error loading data:', error);
                document.getElementById('chart').innerHTML = 
                    '<div style="text-align: center; padding: 50px; color: #ba684e;">' +
                    '<p>Error loading data. Please ensure ib_risk_reward_analysis.csv is in the same directory.</p>' +
                    '</div>';
            });
    </script>
</body>
</html>
