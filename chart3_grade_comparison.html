<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grade Distribution Comparison | Fenwick Tutoring</title>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: white;
            color: #000;
            line-height: 1.6;
        }

        .container {
            width: 100%;
            max-width: none;
            margin: 0;
            background-color: white;
            padding: 30px 5%;
        }

        h1 {
            color: #5d2137;
            font-size: clamp(22px, 4vw, 32px);
            margin-bottom: 8px;
            font-weight: bold;
        }

        .subtitle {
            color: #ba684e;
            font-size: clamp(14px, 2vw, 18px);
            margin-bottom: 25px;
        }

        #chart {
            width: 100%;
            height: 500px;
            margin: 20px 0 15px 0;
            overflow: visible;
        }

        #chart, #chart * {
            touch-action: pan-y !important;
        }

        /* Comparison search row */
        .comparison-search-row {
            display: flex;
            gap: 20px;
            margin: 0 auto 20px auto;
            max-width: 820px;
        }

        .search-column {
            flex: 1;
            min-width: 0;
        }

        .search-label {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 6px;
            display: block;
        }

        .search-label-a {
            color: #5d2137;
        }

        .search-label-b {
            color: #ba684e;
        }

        /* Search Container */
        .search-container {
            position: relative;
            width: 100%;
        }

        .search-wrapper {
            position: relative;
            display: flex;
            align-items: center;
            background: #fee9e2;
            border: 2px solid #ba684e;
            border-radius: 8px;
            overflow: hidden;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }

        .search-wrapper-a {
            border-color: #5d2137;
        }

        .search-wrapper-b {
            border-color: #ba684e;
        }

        .search-wrapper:focus-within {
            box-shadow: 0 0 0 3px rgba(93, 33, 55, 0.15);
        }

        .search-wrapper-a:focus-within {
            border-color: #5d2137;
            box-shadow: 0 0 0 3px rgba(93, 33, 55, 0.15);
        }

        .search-wrapper-b:focus-within {
            border-color: #ba684e;
            box-shadow: 0 0 0 3px rgba(186, 104, 78, 0.15);
        }

        .search-icon {
            padding: 0 12px;
            color: #ba684e;
            display: flex;
            align-items: center;
        }

        .search-icon-a {
            color: #5d2137;
        }

        .search-icon-b {
            color: #ba684e;
        }

        .search-icon svg {
            width: 18px;
            height: 18px;
        }

        .subject-search {
            flex: 1;
            padding: 12px 12px 12px 0;
            border: none;
            background: transparent;
            font-size: 15px;
            color: #5d2137;
            outline: none;
            font-family: inherit;
        }

        .subject-search::placeholder {
            color: #ba684e;
            opacity: 0.7;
        }

        .clear-btn {
            padding: 8px 12px;
            background: none;
            border: none;
            color: #ba684e;
            cursor: pointer;
            font-size: 18px;
            display: none;
            transition: color 0.2s ease;
        }

        .clear-btn:hover {
            color: #5d2137;
        }

        .clear-btn.visible {
            display: block;
        }

        /* Dropdown */
        .dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #ba684e;
            border-top: none;
            border-radius: 0 0 8px 8px;
            max-height: 250px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
            box-shadow: 0 4px 12px rgba(93, 33, 55, 0.15);
        }

        .dropdown-a {
            border-color: #5d2137;
        }

        .dropdown-b {
            border-color: #ba684e;
        }

        .dropdown.active {
            display: block;
        }

        .dropdown-item {
            padding: 12px 16px;
            cursor: pointer;
            border-bottom: 1px solid #fee9e2;
            transition: background-color 0.15s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .dropdown-item:last-child {
            border-bottom: none;
        }

        .dropdown-item:hover,
        .dropdown-item.highlighted {
            background-color: #fee9e2;
        }

        .dropdown-item .subject-name {
            flex: 1;
            color: #5d2137;
            font-weight: 500;
        }

        .dropdown-item .subject-level {
            color: #ba684e;
            font-size: 13px;
        }

        .dropdown-item .group-badge {
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 3px;
            color: white;
            font-weight: 600;
            background-color: #5d2137;
        }

        .no-results {
            padding: 16px;
            text-align: center;
            color: #ba684e;
            font-style: italic;
        }

        /* Comparison info panel */
        .comparison-panel {
            display: flex;
            gap: 20px;
            margin: 20px auto 0 auto;
            max-width: 820px;
        }

        .stat-card {
            flex: 1;
            background: linear-gradient(135deg, #fee9e2 0%, #fff 100%);
            border-radius: 8px;
            padding: 16px 20px;
            border: 2px solid #eee;
            min-width: 0;
        }

        .stat-card-a {
            border-left: 5px solid #5d2137;
        }

        .stat-card-b {
            border-left: 5px solid #ba684e;
        }

        .stat-card .card-title {
            font-weight: 700;
            font-size: 16px;
            margin-bottom: 10px;
            color: #5d2137;
        }

        .stat-card-b .card-title {
            color: #ba684e;
        }

        .stat-card .stat-row {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            padding: 3px 0;
        }

        .stat-card .stat-label {
            color: #888;
            font-weight: 500;
        }

        .stat-card .stat-value {
            font-weight: 600;
            color: #333;
        }

        .stat-card .empty-message {
            color: #ba684e;
            font-style: italic;
            font-size: 14px;
        }

        .footer {
            text-align: center;
            color: #ba684e;
            font-size: 13px;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #fee9e2;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px 4%;
            }

            #chart {
                height: 300px;
            }

            .comparison-search-row {
                flex-direction: column;
                gap: 12px;
            }

            .subject-search {
                font-size: 16px;
                padding: 14px 12px 14px 0;
            }

            .dropdown {
                max-height: 200px;
            }

            .dropdown-item {
                padding: 14px 16px;
            }

            .comparison-panel {
                flex-direction: column;
                gap: 12px;
            }

            .stat-card {
                padding: 14px 16px;
            }
        }

        @media (min-width: 1200px) {
            #chart {
                height: 550px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Grade Distribution Comparison</h1>
        <p class="subtitle">Compare the grade distributions of any two IB subjects</p>

        <!-- Two search bars side by side -->
        <div class="comparison-search-row">
            <div class="search-column">
                <span class="search-label search-label-a">Subject A</span>
                <div class="search-container">
                    <div class="search-wrapper search-wrapper-a">
                        <div class="search-icon search-icon-a">
                            <svg fill="currentColor" viewBox="0 0 16 16">
                                <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                            </svg>
                        </div>
                        <input
                            type="text"
                            class="subject-search"
                            id="search-a"
                            placeholder="Search for a subject..."
                            autocomplete="off"
                        >
                        <button class="clear-btn" id="clear-a">&times;</button>
                    </div>
                    <div class="dropdown dropdown-a" id="dropdown-a"></div>
                </div>
            </div>
            <div class="search-column">
                <span class="search-label search-label-b">Subject B</span>
                <div class="search-container">
                    <div class="search-wrapper search-wrapper-b">
                        <div class="search-icon search-icon-b">
                            <svg fill="currentColor" viewBox="0 0 16 16">
                                <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                            </svg>
                        </div>
                        <input
                            type="text"
                            class="subject-search"
                            id="search-b"
                            placeholder="Search for a subject..."
                            autocomplete="off"
                        >
                        <button class="clear-btn" id="clear-b">&times;</button>
                    </div>
                    <div class="dropdown dropdown-b" id="dropdown-b"></div>
                </div>
            </div>
        </div>

        <div id="chart"></div>

        <!-- Info panel -->
        <div class="comparison-panel">
            <div class="stat-card stat-card-a" id="card-a">
                <div class="empty-message" id="empty-a">Select Subject A above</div>
                <div id="stats-a" style="display:none;">
                    <div class="card-title" id="title-a"></div>
                    <div class="stat-row"><span class="stat-label">Mean Grade</span><span class="stat-value" id="mean-a"></span></div>
                    <div class="stat-row"><span class="stat-label">Std Deviation</span><span class="stat-value" id="std-a"></span></div>
                    <div class="stat-row"><span class="stat-label">Students</span><span class="stat-value" id="students-a"></span></div>
                    <div class="stat-row"><span class="stat-label">Grade 6-7 %</span><span class="stat-value" id="grade67-a"></span></div>
                    <div class="stat-row"><span class="stat-label">Grade 1-3 %</span><span class="stat-value" id="grade13-a"></span></div>
                </div>
            </div>
            <div class="stat-card stat-card-b" id="card-b">
                <div class="empty-message" id="empty-b">Select Subject B above</div>
                <div id="stats-b" style="display:none;">
                    <div class="card-title" id="title-b"></div>
                    <div class="stat-row"><span class="stat-label">Mean Grade</span><span class="stat-value" id="mean-b"></span></div>
                    <div class="stat-row"><span class="stat-label">Std Deviation</span><span class="stat-value" id="std-b"></span></div>
                    <div class="stat-row"><span class="stat-label">Students</span><span class="stat-value" id="students-b"></span></div>
                    <div class="stat-row"><span class="stat-label">Grade 6-7 %</span><span class="stat-value" id="grade67-b"></span></div>
                    <div class="stat-row"><span class="stat-label">Grade 1-3 %</span><span class="stat-value" id="grade13-b"></span></div>
                </div>
            </div>
        </div>

        <div class="footer">
            <p><strong>Fenwick Tutoring</strong> | Data: IB May 2025 Statistical Bulletin</p>
        </div>
    </div>

    <script>
        const isMobile = document.querySelector('.container').offsetWidth < 600;

        let allSubjects = [];
        let selectedA = null;
        let selectedB = null;
        let highlightedIndexA = -1;
        let highlightedIndexB = -1;

        const COLOR_A = '#5d2137';
        const COLOR_B = '#ba684e';

        const groupColors = {
            'Sciences': '#5d2137',
            'Mathematics': '#ba684e',
            'Individuals and Societies': '#2a6b4f',
            'Language Acquisition': '#2e5c8a',
            'Language and Literature': '#7a5195',
            'The Arts': '#c46c00',
            'Interdisciplinary': '#999999'
        };

        // Parse CSV
        function parseCSVRow(row) {
            const result = [];
            let current = '';
            let inQuotes = false;
            for (let i = 0; i < row.length; i++) {
                const char = row[i];
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            result.push(current.trim());
            return result;
        }

        // Embedded subject data
        allSubjects = [
            {subject:"Business Management",level:"HL",group:"Individuals and Societies",students:24513,meanGrade:5.0,stdDev:1.15,pctGrade1:0.2,pctGrade2:1.9,pctGrade3:8.6,pctGrade4:22.0,pctGrade5:33.0,pctGrade6:25.9,pctGrade7:7.5,pctGrade13:10.7,pctGrade67:33.4,displayName:"Business Management HL"},
            {subject:"Business Management",level:"SL",group:"Individuals and Societies",students:13304,meanGrade:4.9,stdDev:1.33,pctGrade1:0.5,pctGrade2:4.1,pctGrade3:10.2,pctGrade4:19.5,pctGrade5:26.4,pctGrade6:25.0,pctGrade7:11.2,pctGrade13:14.8,pctGrade67:36.2,displayName:"Business Management SL"},
            {subject:"Economics",level:"HL",group:"Individuals and Societies",students:20089,meanGrade:5.2,stdDev:1.24,pctGrade1:0.2,pctGrade2:2.1,pctGrade3:7.9,pctGrade4:17.7,pctGrade5:27.6,pctGrade6:29.9,pctGrade7:14.0,pctGrade13:10.2,pctGrade67:43.9,displayName:"Economics HL"},
            {subject:"Economics",level:"SL",group:"Individuals and Societies",students:10797,meanGrade:5.0,stdDev:1.41,pctGrade1:0.6,pctGrade2:4.4,pctGrade3:12.1,pctGrade4:18.2,pctGrade5:24.0,pctGrade6:23.5,pctGrade7:14.9,pctGrade13:17.1,pctGrade67:38.4,displayName:"Economics SL"},
            {subject:"Geography",level:"HL",group:"Individuals and Societies",students:5218,meanGrade:5.3,stdDev:1.08,pctGrade1:0.1,pctGrade2:0.6,pctGrade3:5.0,pctGrade4:14.7,pctGrade5:33.1,pctGrade6:33.1,pctGrade7:13.0,pctGrade13:5.7,pctGrade67:46.1,displayName:"Geography HL"},
            {subject:"Geography",level:"SL",group:"Individuals and Societies",students:4528,meanGrade:4.9,stdDev:1.32,pctGrade1:0.4,pctGrade2:4.2,pctGrade3:12.8,pctGrade4:17.0,pctGrade5:27.5,pctGrade6:25.9,pctGrade7:9.0,pctGrade13:17.4,pctGrade67:34.9,displayName:"Geography SL"},
            {subject:"Global Politics",level:"HL",group:"Individuals and Societies",students:6263,meanGrade:5.1,stdDev:1.03,pctGrade1:0.3,pctGrade2:1.1,pctGrade3:5.0,pctGrade4:19.0,pctGrade5:37.0,pctGrade6:30.3,pctGrade7:5.6,pctGrade13:6.4,pctGrade67:35.9,displayName:"Global Politics HL"},
            {subject:"Global Politics",level:"SL",group:"Individuals and Societies",students:4111,meanGrade:4.7,stdDev:1.21,pctGrade1:0.2,pctGrade2:3.6,pctGrade3:11.9,pctGrade4:21.8,pctGrade5:33.2,pctGrade6:17.5,pctGrade7:6.4,pctGrade13:15.7,pctGrade67:23.9,displayName:"Global Politics SL"},
            {subject:"History",level:"HL",group:"Individuals and Societies",students:37228,meanGrade:4.4,stdDev:1.18,pctGrade1:0.5,pctGrade2:5.8,pctGrade3:14.2,pctGrade4:28.8,pctGrade5:30.3,pctGrade6:15.2,pctGrade7:2.6,pctGrade13:20.5,pctGrade67:17.8,displayName:"History HL"},
            {subject:"History",level:"SL",group:"Individuals and Societies",students:9253,meanGrade:4.7,stdDev:1.18,pctGrade1:0.8,pctGrade2:4.6,pctGrade3:8.3,pctGrade4:24.2,pctGrade5:34.6,pctGrade6:21.5,pctGrade7:3.6,pctGrade13:13.7,pctGrade67:25.1,displayName:"History SL"},
            {subject:"Psychology",level:"HL",group:"Individuals and Societies",students:15094,meanGrade:4.8,stdDev:1.2,pctGrade1:0.4,pctGrade2:3.1,pctGrade3:10.9,pctGrade4:22.8,pctGrade5:31.4,pctGrade6:24.4,pctGrade7:5.6,pctGrade13:14.4,pctGrade67:30.0,displayName:"Psychology HL"},
            {subject:"Psychology",level:"SL",group:"Individuals and Societies",students:13565,meanGrade:4.4,stdDev:1.35,pctGrade1:1.1,pctGrade2:7.7,pctGrade3:15.6,pctGrade4:25.0,pctGrade5:21.8,pctGrade6:19.2,pctGrade7:4.3,pctGrade13:24.4,pctGrade67:23.5,displayName:"Psychology SL"},
            {subject:"Environmental Systems and Societies",level:"SL",group:"Interdisciplinary",students:22078,meanGrade:4.3,stdDev:1.32,pctGrade1:1.1,pctGrade2:7.1,pctGrade3:21.0,pctGrade4:25.0,pctGrade5:24.6,pctGrade6:12.9,pctGrade7:5.0,pctGrade13:29.2,pctGrade67:17.9,displayName:"Environmental Systems and Societies SL"},
            {subject:"Chinese B",level:"HL",group:"Language Acquisition",students:834,meanGrade:6.0,stdDev:1.01,pctGrade1:0.5,pctGrade2:2.4,pctGrade3:6.4,pctGrade4:12.7,pctGrade5:42.7,pctGrade6:35.0,pctGrade7:0.0,pctGrade13:9.3,pctGrade67:35.0,displayName:"Chinese B HL"},
            {subject:"Chinese B",level:"SL",group:"Language Acquisition",students:3068,meanGrade:5.7,stdDev:1.26,pctGrade1:1.1,pctGrade2:4.5,pctGrade3:14.2,pctGrade4:18.2,pctGrade5:26.1,pctGrade6:34.7,pctGrade7:0.0,pctGrade13:19.8,pctGrade67:34.7,displayName:"Chinese B SL"},
            {subject:"English B",level:"HL",group:"Language Acquisition",students:23089,meanGrade:5.6,stdDev:0.9,pctGrade1:0.0,pctGrade2:0.1,pctGrade3:2.1,pctGrade4:8.8,pctGrade5:24.6,pctGrade6:50.2,pctGrade7:13.4,pctGrade13:2.2,pctGrade67:63.6,displayName:"English B HL"},
            {subject:"English B",level:"SL",group:"Language Acquisition",students:4648,meanGrade:5.5,stdDev:1.07,pctGrade1:0.0,pctGrade2:0.6,pctGrade3:4.2,pctGrade4:13.6,pctGrade5:25.4,pctGrade6:39.9,pctGrade7:14.4,pctGrade13:4.8,pctGrade67:54.3,displayName:"English B SL"},
            {subject:"French AB Initio",level:"SL",group:"Language Acquisition",students:5748,meanGrade:4.7,stdDev:1.29,pctGrade1:0.2,pctGrade2:2.7,pctGrade3:16.1,pctGrade4:24.1,pctGrade5:26.2,pctGrade6:19.9,pctGrade7:9.2,pctGrade13:19.0,pctGrade67:29.1,displayName:"French AB Initio SL"},
            {subject:"French B",level:"HL",group:"Language Acquisition",students:3715,meanGrade:5.2,stdDev:1.41,pctGrade1:0.6,pctGrade2:3.4,pctGrade3:10.2,pctGrade4:14.6,pctGrade5:20.5,pctGrade6:30.0,pctGrade7:19.5,pctGrade13:14.2,pctGrade67:49.5,displayName:"French B HL"},
            {subject:"French B",level:"SL",group:"Language Acquisition",students:12639,meanGrade:5.1,stdDev:1.23,pctGrade1:0.2,pctGrade2:1.9,pctGrade3:8.7,pctGrade4:20.0,pctGrade5:30.0,pctGrade6:24.6,pctGrade7:13.2,pctGrade13:10.8,pctGrade67:37.8,displayName:"French B SL"},
            {subject:"German B",level:"HL",group:"Language Acquisition",students:1970,meanGrade:5.6,stdDev:1.03,pctGrade1:0.1,pctGrade2:2.8,pctGrade3:12.1,pctGrade4:27.3,pctGrade5:36.8,pctGrade6:20.1,pctGrade7:0.0,pctGrade13:15.0,pctGrade67:20.1,displayName:"German B HL"},
            {subject:"German B",level:"SL",group:"Language Acquisition",students:2276,meanGrade:5.1,stdDev:1.2,pctGrade1:0.9,pctGrade2:8.2,pctGrade3:22.5,pctGrade4:28.1,pctGrade5:25.3,pctGrade6:14.1,pctGrade7:0.0,pctGrade13:31.6,pctGrade67:14.1,displayName:"German B SL"},
            {subject:"Mandarin AB Initio",level:"SL",group:"Language Acquisition",students:1435,meanGrade:5.2,stdDev:1.5,pctGrade1:0.2,pctGrade2:2.5,pctGrade3:14.1,pctGrade4:19.1,pctGrade5:14.7,pctGrade6:21.2,pctGrade7:25.7,pctGrade13:16.8,pctGrade67:46.9,displayName:"Mandarin AB Initio SL"},
            {subject:"Spanish AB Initio",level:"SL",group:"Language Acquisition",students:10543,meanGrade:4.9,stdDev:1.21,pctGrade1:0.1,pctGrade2:1.9,pctGrade3:11.2,pctGrade4:23.1,pctGrade5:31.1,pctGrade6:21.0,pctGrade7:10.1,pctGrade13:13.2,pctGrade67:31.1,displayName:"Spanish AB Initio SL"},
            {subject:"Spanish B",level:"HL",group:"Language Acquisition",students:8520,meanGrade:5.2,stdDev:1.28,pctGrade1:0.4,pctGrade2:1.8,pctGrade3:8.1,pctGrade4:17.9,pctGrade5:25.3,pctGrade6:28.1,pctGrade7:16.0,pctGrade13:10.3,pctGrade67:44.1,displayName:"Spanish B HL"},
            {subject:"Spanish B",level:"SL",group:"Language Acquisition",students:22140,meanGrade:4.9,stdDev:1.17,pctGrade1:0.1,pctGrade2:1.2,pctGrade3:10.1,pctGrade4:26.2,pctGrade5:30.6,pctGrade6:19.8,pctGrade7:9.8,pctGrade13:11.4,pctGrade67:29.6,displayName:"Spanish B SL"},
            {subject:"Chinese A: Language and Literature",level:"HL",group:"Language and Literature",students:742,meanGrade:5.3,stdDev:0.93,pctGrade1:0.0,pctGrade2:0.7,pctGrade3:13.7,pctGrade4:45.6,pctGrade5:37.5,pctGrade6:2.2,pctGrade7:0.0,pctGrade13:60.0,pctGrade67:85.3,displayName:"Chinese A: Language and Literature HL"},
            {subject:"Chinese A: Language and Literature",level:"SL",group:"Language and Literature",students:3090,meanGrade:5.4,stdDev:0.88,pctGrade1:0.1,pctGrade2:1.7,pctGrade3:13.5,pctGrade4:38.7,pctGrade5:37.9,pctGrade6:7.7,pctGrade7:0.0,pctGrade13:15.3,pctGrade67:7.7,displayName:"Chinese A: Language and Literature SL"},
            {subject:"English A: Language and Literature",level:"HL",group:"Language and Literature",students:43338,meanGrade:4.8,stdDev:1.03,pctGrade1:0.0,pctGrade2:1.0,pctGrade3:8.4,pctGrade4:26.3,pctGrade5:35.9,pctGrade6:21.5,pctGrade7:4.1,pctGrade13:9.4,pctGrade67:25.6,displayName:"English A: Language and Literature HL"},
            {subject:"English A: Language and Literature",level:"SL",group:"Language and Literature",students:31216,meanGrade:4.9,stdDev:1.04,pctGrade1:0.1,pctGrade2:1.1,pctGrade3:6.5,pctGrade4:24.0,pctGrade5:35.5,pctGrade6:25.5,pctGrade7:4.9,pctGrade13:7.7,pctGrade67:30.4,displayName:"English A: Language and Literature SL"},
            {subject:"English A: Literature",level:"HL",group:"Language and Literature",students:30239,meanGrade:4.6,stdDev:0.96,pctGrade1:0.0,pctGrade2:1.6,pctGrade3:8.4,pctGrade4:37.4,pctGrade5:33.4,pctGrade6:16.0,pctGrade7:1.5,pctGrade13:10.0,pctGrade67:17.5,displayName:"English A: Literature HL"},
            {subject:"English A: Literature",level:"SL",group:"Language and Literature",students:5734,meanGrade:5.1,stdDev:1.0,pctGrade1:0.0,pctGrade2:0.4,pctGrade3:5.0,pctGrade4:19.8,pctGrade5:37.9,pctGrade6:28.8,pctGrade7:7.0,pctGrade13:5.4,pctGrade67:35.8,displayName:"English A: Literature SL"},
            {subject:"French A: Language and Literature",level:"HL",group:"Language and Literature",students:828,meanGrade:4.8,stdDev:0.94,pctGrade1:0.0,pctGrade2:0.5,pctGrade3:5.7,pctGrade4:30.3,pctGrade5:40.6,pctGrade6:18.0,pctGrade7:4.0,pctGrade13:36.5,pctGrade67:4.0,displayName:"French A: Language and Literature HL"},
            {subject:"French A: Language and Literature",level:"SL",group:"Language and Literature",students:1006,meanGrade:4.8,stdDev:0.96,pctGrade1:0.0,pctGrade2:0.7,pctGrade3:5.6,pctGrade4:29.6,pctGrade5:38.7,pctGrade6:20.7,pctGrade7:3.6,pctGrade13:35.9,pctGrade67:3.6,displayName:"French A: Language and Literature SL"},
            {subject:"German A: Language and Literature",level:"HL",group:"Language and Literature",students:507,meanGrade:5.3,stdDev:0.91,pctGrade1:0.0,pctGrade2:0.0,pctGrade3:1.6,pctGrade4:18.3,pctGrade5:39.8,pctGrade6:30.6,pctGrade7:8.9,pctGrade13:59.7,pctGrade67:8.9,displayName:"German A: Language and Literature HL"},
            {subject:"German A: Language and Literature",level:"SL",group:"Language and Literature",students:746,meanGrade:5.2,stdDev:0.91,pctGrade1:0.0,pctGrade2:0.0,pctGrade3:1.7,pctGrade4:20.2,pctGrade5:42.0,pctGrade6:27.2,pctGrade7:8.3,pctGrade13:63.9,pctGrade67:8.3,displayName:"German A: Language and Literature SL"},
            {subject:"Spanish A: Language and Literature",level:"HL",group:"Language and Literature",students:5122,meanGrade:4.8,stdDev:0.96,pctGrade1:0.0,pctGrade2:0.6,pctGrade3:7.5,pctGrade4:28.3,pctGrade5:38.8,pctGrade6:20.8,pctGrade7:2.7,pctGrade13:36.4,pctGrade67:2.7,displayName:"Spanish A: Language and Literature HL"},
            {subject:"Spanish A: Language and Literature",level:"SL",group:"Language and Literature",students:2741,meanGrade:4.8,stdDev:1.06,pctGrade1:0.0,pctGrade2:1.4,pctGrade3:9.2,pctGrade4:24.6,pctGrade5:35.8,pctGrade6:23.0,pctGrade7:4.5,pctGrade13:35.2,pctGrade67:4.5,displayName:"Spanish A: Language and Literature SL"},
            {subject:"Mathematics Analysis and Approaches",level:"HL",group:"Mathematics",students:24966,meanGrade:4.9,stdDev:1.44,pctGrade1:0.7,pctGrade2:5.1,pctGrade3:10.8,pctGrade4:21.8,pctGrade5:23.7,pctGrade6:20.3,pctGrade7:16.4,pctGrade13:16.6,pctGrade67:36.7,displayName:"Mathematics Analysis and Approaches HL"},
            {subject:"Mathematics Analysis and Approaches",level:"SL",group:"Mathematics",students:42358,meanGrade:4.5,stdDev:1.44,pctGrade1:1.3,pctGrade2:8.0,pctGrade3:15.2,pctGrade4:24.7,pctGrade5:23.1,pctGrade6:16.8,pctGrade7:9.2,pctGrade13:24.5,pctGrade67:26.0,displayName:"Mathematics Analysis and Approaches SL"},
            {subject:"Mathematics Applications and Interpretation",level:"HL",group:"Mathematics",students:8527,meanGrade:4.5,stdDev:1.45,pctGrade1:1.6,pctGrade2:8.1,pctGrade3:13.9,pctGrade4:25.7,pctGrade5:23.7,pctGrade6:16.0,pctGrade7:9.6,pctGrade13:23.6,pctGrade67:25.6,displayName:"Mathematics Applications and Interpretation HL"},
            {subject:"Mathematics Applications and Interpretation",level:"SL",group:"Mathematics",students:42968,meanGrade:3.9,stdDev:1.49,pctGrade1:5.4,pctGrade2:14.0,pctGrade3:20.0,pctGrade4:23.9,pctGrade5:18.4,pctGrade6:11.1,pctGrade7:4.0,pctGrade13:39.4,pctGrade67:15.1,displayName:"Mathematics Applications and Interpretation SL"},
            {subject:"Biology",level:"HL",group:"Sciences",students:33102,meanGrade:4.5,stdDev:1.38,pctGrade1:1.0,pctGrade2:6.7,pctGrade3:18.0,pctGrade4:24.8,pctGrade5:23.9,pctGrade6:16.6,pctGrade7:7.2,pctGrade13:25.7,pctGrade67:23.8,displayName:"Biology HL"},
            {subject:"Biology",level:"SL",group:"Sciences",students:21939,meanGrade:4.3,stdDev:1.37,pctGrade1:0.8,pctGrade2:8.7,pctGrade3:21.6,pctGrade4:26.1,pctGrade5:20.6,pctGrade6:13.9,pctGrade7:5.9,pctGrade13:31.1,pctGrade67:19.8,displayName:"Biology SL"},
            {subject:"Chemistry",level:"HL",group:"Sciences",students:20095,meanGrade:4.8,stdDev:1.47,pctGrade1:0.7,pctGrade2:5.0,pctGrade3:15.8,pctGrade4:19.4,pctGrade5:22.3,pctGrade6:20.7,pctGrade7:15.0,pctGrade13:21.5,pctGrade67:35.7,displayName:"Chemistry HL"},
            {subject:"Chemistry",level:"SL",group:"Sciences",students:17646,meanGrade:4.3,stdDev:1.53,pctGrade1:1.5,pctGrade2:11.0,pctGrade3:19.1,pctGrade4:20.9,pctGrade5:20.6,pctGrade6:15.3,pctGrade7:9.5,pctGrade13:31.6,pctGrade67:24.8,displayName:"Chemistry SL"},
            {subject:"Computer Science",level:"HL",group:"Sciences",students:4751,meanGrade:4.7,stdDev:1.36,pctGrade1:0.2,pctGrade2:5.9,pctGrade3:15.8,pctGrade4:20.9,pctGrade5:27.0,pctGrade6:20.5,pctGrade7:8.5,pctGrade13:21.9,pctGrade67:29.0,displayName:"Computer Science HL"},
            {subject:"Computer Science",level:"SL",group:"Sciences",students:4402,meanGrade:4.3,stdDev:1.51,pctGrade1:1.5,pctGrade2:10.1,pctGrade3:21.9,pctGrade4:19.7,pctGrade5:20.2,pctGrade6:15.6,pctGrade7:8.5,pctGrade13:33.5,pctGrade67:24.1,displayName:"Computer Science SL"},
            {subject:"Design Technology",level:"HL",group:"Sciences",students:2127,meanGrade:4.7,stdDev:1.11,pctGrade1:0.1,pctGrade2:2.1,pctGrade3:10.1,pctGrade4:29.5,pctGrade5:30.7,pctGrade6:22.2,pctGrade7:4.4,pctGrade13:12.3,pctGrade67:26.6,displayName:"Design Technology HL"},
            {subject:"Physics",level:"HL",group:"Sciences",students:17984,meanGrade:4.9,stdDev:1.49,pctGrade1:0.3,pctGrade2:4.8,pctGrade3:15.0,pctGrade4:19.8,pctGrade5:22.2,pctGrade6:17.9,pctGrade7:19.2,pctGrade13:20.1,pctGrade67:37.1,displayName:"Physics HL"},
            {subject:"Physics",level:"SL",group:"Sciences",students:14442,meanGrade:4.2,stdDev:1.5,pctGrade1:1.3,pctGrade2:8.7,pctGrade3:25.9,pctGrade4:23.0,pctGrade5:17.1,pctGrade6:11.8,pctGrade7:10.3,pctGrade13:35.9,pctGrade67:22.1,displayName:"Physics SL"},
            {subject:"Sports Exercise and Health Science",level:"HL",group:"Sciences",students:1947,meanGrade:4.8,stdDev:1.36,pctGrade1:0.5,pctGrade2:4.3,pctGrade3:14.0,pctGrade4:23.1,pctGrade5:25.0,pctGrade6:20.9,pctGrade7:10.6,pctGrade13:18.8,pctGrade67:31.5,displayName:"Sports Exercise and Health Science HL"},
            {subject:"Sports Exercise and Health Science",level:"SL",group:"Sciences",students:5987,meanGrade:3.8,stdDev:1.35,pctGrade1:1.8,pctGrade2:14.7,pctGrade3:24.7,pctGrade4:24.1,pctGrade5:16.7,pctGrade6:8.4,pctGrade7:3.2,pctGrade13:41.2,pctGrade67:11.6,displayName:"Sports Exercise and Health Science SL"},
            {subject:"Film",level:"HL",group:"The Arts",students:2962,meanGrade:4.4,stdDev:1.2,pctGrade1:1.0,pctGrade2:4.0,pctGrade3:14.2,pctGrade4:30.5,pctGrade5:27.1,pctGrade6:14.6,pctGrade7:3.7,pctGrade13:19.2,pctGrade67:18.3,displayName:"Film HL"},
            {subject:"Music",level:"HL",group:"The Arts",students:1475,meanGrade:4.8,stdDev:1.13,pctGrade1:0.0,pctGrade2:1.5,pctGrade3:11.1,pctGrade4:28.1,pctGrade5:29.4,pctGrade6:20.1,pctGrade7:6.4,pctGrade13:40.7,pctGrade67:6.4,displayName:"Music HL"},
            {subject:"Theatre",level:"HL",group:"The Arts",students:2518,meanGrade:5.1,stdDev:1.24,pctGrade1:0.0,pctGrade2:1.9,pctGrade3:8.8,pctGrade4:18.9,pctGrade5:27.6,pctGrade6:26.2,pctGrade7:13.9,pctGrade13:29.6,pctGrade67:13.9,displayName:"Theatre HL"},
            {subject:"Visual Arts",level:"HL",group:"The Arts",students:10312,meanGrade:4.3,stdDev:1.13,pctGrade1:0.4,pctGrade2:3.2,pctGrade3:22.8,pctGrade4:32.1,pctGrade5:24.2,pctGrade6:11.7,pctGrade7:2.6,pctGrade13:26.4,pctGrade67:14.3,displayName:"Visual Arts HL"},
            {subject:"Visual Arts",level:"SL",group:"The Arts",students:6080,meanGrade:4.0,stdDev:1.0,pctGrade1:0.5,pctGrade2:5.3,pctGrade3:22.1,pctGrade4:43.0,pctGrade5:18.5,pctGrade6:6.2,pctGrade7:0.7,pctGrade13:27.9,pctGrade67:6.9,displayName:"Visual Arts SL"}
        ];

        (function init() {
                initializeSearch('a');
                initializeSearch('b');

                // Pre-load default comparison
                const defaultA = allSubjects.find(s => s.displayName === 'Physics HL');
                const defaultB = allSubjects.find(s => s.displayName === 'Physics SL');
                if (defaultA) {
                    selectedA = defaultA;
                    document.getElementById('search-a').value = defaultA.displayName;
                    document.getElementById('clear-a').classList.add('visible');
                }
                if (defaultB) {
                    selectedB = defaultB;
                    document.getElementById('search-b').value = defaultB.displayName;
                    document.getElementById('clear-b').classList.add('visible');
                }

                updateChart();
                updateInfoPanel();

                window.addEventListener('resize', handleResize);
                handleResize();
        })();

        function initializeSearch(suffix) {
            const searchInput = document.getElementById(`search-${suffix}`);
            const dropdown = document.getElementById(`dropdown-${suffix}`);
            const clearBtn = document.getElementById(`clear-${suffix}`);
            let highlightedIndex = -1;

            searchInput.addEventListener('input', function() {
                const query = this.value.trim().toLowerCase();
                highlightedIndex = -1;

                if (query.length === 0) {
                    dropdown.classList.remove('active');
                    clearBtn.classList.remove('visible');
                    return;
                }

                clearBtn.classList.add('visible');

                const matches = allSubjects.filter(s =>
                    s.displayName.toLowerCase().includes(query) ||
                    s.subject.toLowerCase().includes(query) ||
                    s.level.toLowerCase().includes(query) ||
                    s.group.toLowerCase().includes(query)
                );

                renderDropdown(matches, dropdown, suffix);
            });

            searchInput.addEventListener('keydown', function(e) {
                const items = dropdown.querySelectorAll('.dropdown-item');

                if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    highlightedIndex = Math.min(highlightedIndex + 1, items.length - 1);
                    updateHighlight(items, highlightedIndex);
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    highlightedIndex = Math.max(highlightedIndex - 1, 0);
                    updateHighlight(items, highlightedIndex);
                } else if (e.key === 'Enter' && highlightedIndex >= 0 && items[highlightedIndex]) {
                    e.preventDefault();
                    selectSubject(items[highlightedIndex].dataset.name, suffix);
                }
            });

            // Show all subjects on focus if input is empty
            searchInput.addEventListener('focus', function() {
                if (this.value.trim().length === 0) {
                    renderDropdown(allSubjects, dropdown, suffix);
                }
            });

            clearBtn.addEventListener('click', function() {
                searchInput.value = '';
                clearBtn.classList.remove('visible');
                dropdown.classList.remove('active');

                if (suffix === 'a') {
                    selectedA = null;
                } else {
                    selectedB = null;
                }

                updateChart();
                updateInfoPanel();
                searchInput.focus();
            });

            document.addEventListener('click', function(e) {
                if (!e.target.closest(`#search-${suffix}`) && !e.target.closest(`#dropdown-${suffix}`) && !e.target.closest(`#clear-${suffix}`)) {
                    dropdown.classList.remove('active');
                }
            });
        }

        function renderDropdown(matches, dropdown, suffix) {
            if (matches.length === 0) {
                dropdown.innerHTML = '<div class="no-results">No subjects found</div>';
                dropdown.classList.add('active');
                return;
            }

            dropdown.innerHTML = matches.map((s, index) => {
                const badgeColor = groupColors[s.group] || '#999';
                return `
                    <div class="dropdown-item" data-name="${s.displayName}" data-index="${index}">
                        <span class="group-badge" style="background-color: ${badgeColor}">${s.group}</span>
                        <span class="subject-name">${s.subject}</span>
                        <span class="subject-level">${s.level}</span>
                    </div>
                `;
            }).join('');

            dropdown.querySelectorAll('.dropdown-item').forEach(item => {
                item.addEventListener('click', function() {
                    selectSubject(this.dataset.name, suffix);
                });
            });

            dropdown.classList.add('active');
        }

        function updateHighlight(items, highlightedIndex) {
            items.forEach((item, index) => {
                item.classList.toggle('highlighted', index === highlightedIndex);
            });
            if (highlightedIndex >= 0 && items[highlightedIndex]) {
                items[highlightedIndex].scrollIntoView({ block: 'nearest' });
            }
        }

        function selectSubject(displayName, suffix) {
            const searchInput = document.getElementById(`search-${suffix}`);
            const dropdown = document.getElementById(`dropdown-${suffix}`);
            const clearBtn = document.getElementById(`clear-${suffix}`);

            searchInput.value = displayName;
            clearBtn.classList.add('visible');
            dropdown.classList.remove('active');

            const subject = allSubjects.find(s => s.displayName === displayName);
            if (suffix === 'a') {
                selectedA = subject;
            } else {
                selectedB = subject;
            }

            updateChart();
            updateInfoPanel();
        }

        function updateChart() {
            const traces = [];
            const shapes = [];
            const annotations = [];
            const grades = ['1', '2', '3', '4', '5', '6', '7'];

            if (selectedA) {
                const gradeValues = [
                    selectedA.pctGrade1, selectedA.pctGrade2, selectedA.pctGrade3,
                    selectedA.pctGrade4, selectedA.pctGrade5, selectedA.pctGrade6,
                    selectedA.pctGrade7
                ];
                traces.push({
                    x: grades,
                    y: gradeValues,
                    type: 'bar',
                    name: selectedA.displayName,
                    marker: { color: COLOR_A, opacity: 0.85 },
                    hovertemplate: `<b>${selectedA.displayName}</b><br>Grade %{x}: %{y:.1f}%<extra></extra>`
                });

                // Mean grade line for A
                shapes.push({
                    type: 'line',
                    x0: selectedA.meanGrade - 1,
                    x1: selectedA.meanGrade - 1,
                    y0: 0,
                    y1: 1,
                    yref: 'paper',
                    line: { color: COLOR_A, width: 2.5, dash: 'dash' }
                });
                annotations.push({
                    x: selectedA.meanGrade - 1,
                    y: 1.06,
                    yref: 'paper',
                    text: `<b>Mean: ${selectedA.meanGrade.toFixed(1)}</b>`,
                    showarrow: false,
                    font: { size: isMobile ? 10 : 12, color: COLOR_A },
                    bgcolor: 'rgba(255,255,255,0.85)',
                    bordercolor: COLOR_A,
                    borderwidth: 1,
                    borderpad: 3
                });
            }

            if (selectedB) {
                const gradeValues = [
                    selectedB.pctGrade1, selectedB.pctGrade2, selectedB.pctGrade3,
                    selectedB.pctGrade4, selectedB.pctGrade5, selectedB.pctGrade6,
                    selectedB.pctGrade7
                ];
                traces.push({
                    x: grades,
                    y: gradeValues,
                    type: 'bar',
                    name: selectedB.displayName,
                    marker: { color: COLOR_B, opacity: 0.85 },
                    hovertemplate: `<b>${selectedB.displayName}</b><br>Grade %{x}: %{y:.1f}%<extra></extra>`
                });

                // Mean grade line for B
                shapes.push({
                    type: 'line',
                    x0: selectedB.meanGrade - 1,
                    x1: selectedB.meanGrade - 1,
                    y0: 0,
                    y1: 1,
                    yref: 'paper',
                    line: { color: COLOR_B, width: 2.5, dash: 'dash' }
                });
                annotations.push({
                    x: selectedB.meanGrade - 1,
                    y: 1.02,
                    yref: 'paper',
                    text: `<b>Mean: ${selectedB.meanGrade.toFixed(1)}</b>`,
                    showarrow: false,
                    font: { size: isMobile ? 10 : 12, color: COLOR_B },
                    bgcolor: 'rgba(255,255,255,0.85)',
                    bordercolor: COLOR_B,
                    borderwidth: 1,
                    borderpad: 3
                });
            }

            if (traces.length === 0) {
                // Nothing selected â€” show empty chart with message
                traces.push({
                    x: grades,
                    y: [0, 0, 0, 0, 0, 0, 0],
                    type: 'bar',
                    marker: { color: '#eee' },
                    showlegend: false,
                    hoverinfo: 'skip'
                });
                annotations.push({
                    x: '4',
                    y: 15,
                    text: 'Select a subject above to see its grade distribution',
                    showarrow: false,
                    font: { size: 16, color: '#ba684e' }
                });
            }

            const chartEl = document.getElementById('chart');
            const narrow = chartEl.offsetWidth < 500;

            const layout = {
                barmode: 'group',
                xaxis: {
                    title: {
                        text: 'Grade',
                        font: { size: narrow ? 11 : 14, color: '#5d2137', family: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto' }
                    },
                    gridcolor: '#fee9e2',
                    fixedrange: true
                },
                yaxis: {
                    title: {
                        text: 'Percentage of Students (%)',
                        font: { size: narrow ? 11 : 14, color: '#5d2137', family: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto' }
                    },
                    gridcolor: '#fee9e2',
                    zeroline: false,
                    fixedrange: true,
                    rangemode: 'tozero'
                },
                hovermode: 'closest',
                dragmode: false,
                showlegend: traces.length > 1 && traces[0].showlegend !== false,
                legend: {
                    x: 0.5,
                    xanchor: 'center',
                    y: 1.12,
                    orientation: 'h',
                    bgcolor: 'rgba(255, 255, 255, 0.9)',
                    font: { size: narrow ? 11 : 13 }
                },
                plot_bgcolor: 'white',
                paper_bgcolor: 'white',
                font: {
                    family: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto',
                    color: '#000'
                },
                margin: narrow
                    ? { l: 45, r: 10, t: 50, b: 50 }
                    : { l: 70, r: 30, t: 60, b: 60 },
                shapes: shapes,
                annotations: annotations
            };

            const config = {
                responsive: true,
                displayModeBar: false,
                displaylogo: false,
                scrollZoom: false
            };

            Plotly.newPlot('chart', traces, layout, config);
        }

        function updateInfoPanel() {
            // Subject A card
            const emptyA = document.getElementById('empty-a');
            const statsA = document.getElementById('stats-a');
            if (selectedA) {
                emptyA.style.display = 'none';
                statsA.style.display = 'block';
                document.getElementById('title-a').textContent = selectedA.displayName;
                document.getElementById('mean-a').textContent = selectedA.meanGrade.toFixed(2);
                document.getElementById('std-a').textContent = selectedA.stdDev.toFixed(2);
                document.getElementById('students-a').textContent = selectedA.students.toLocaleString();
                document.getElementById('grade67-a').textContent = selectedA.pctGrade67.toFixed(1) + '%';
                document.getElementById('grade13-a').textContent = selectedA.pctGrade13.toFixed(1) + '%';
            } else {
                emptyA.style.display = 'block';
                statsA.style.display = 'none';
            }

            // Subject B card
            const emptyB = document.getElementById('empty-b');
            const statsB = document.getElementById('stats-b');
            if (selectedB) {
                emptyB.style.display = 'none';
                statsB.style.display = 'block';
                document.getElementById('title-b').textContent = selectedB.displayName;
                document.getElementById('mean-b').textContent = selectedB.meanGrade.toFixed(2);
                document.getElementById('std-b').textContent = selectedB.stdDev.toFixed(2);
                document.getElementById('students-b').textContent = selectedB.students.toLocaleString();
                document.getElementById('grade67-b').textContent = selectedB.pctGrade67.toFixed(1) + '%';
                document.getElementById('grade13-b').textContent = selectedB.pctGrade13.toFixed(1) + '%';
            } else {
                emptyB.style.display = 'block';
                statsB.style.display = 'none';
            }
        }

        function handleResize() {
            const chartEl = document.getElementById('chart');
            const narrow = chartEl.offsetWidth < 500;
            chartEl.style.height = narrow ? '300px' : '500px';
            updateChart();
        }
    </script>
</body>
</html>
